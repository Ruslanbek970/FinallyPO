<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!-- ROLES -->
    <changeSet id="013-seed-roles" author="team">
        <insert tableName="roles"><column name="name" value="ROLE_ADMIN"/></insert>
        <insert tableName="roles"><column name="name" value="ROLE_MANAGER"/></insert>
        <insert tableName="roles"><column name="name" value="ROLE_USER"/></insert>
    </changeSet>

    <!-- USERS  AdminRus55, ManagerKas55, User123!  -->
    <changeSet id="014-seed-users" author="team">
        <insert tableName="users">
            <column name="email" value="ruslanbek@booking.kz"/>
            <column name="password_hash" value="$2a$10$G1CJ/UYk5a.orpgS5KWwieEmzvlFeh.vzt1abZEHH9cT.7p.MqLk2"/>
            <column name="full_name" value="System Admin"/>
            <column name="phone" value="+7 777 111 11 11"/>
            <column name="active" valueBoolean="true"/>
        </insert>

        <insert tableName="users">
            <column name="email" value="kasym@booking.kz"/>
            <column name="password_hash" value="$2a$10$G1CJ/UYk5a.orpgS5KWwieEmzvlFeh.vzt1abZEHH9cT.7p.MqLk2"/>
            <column name="full_name" value="Hotel Manager"/>
            <column name="phone" value="+7 777 222 22 22"/>
            <column name="active" valueBoolean="true"/>
        </insert>

        <insert tableName="users">
            <column name="email" value="maksat@booking.kz"/>
            <column name="password_hash" value="$2a$10$G1CJ/UYk5a.orpgS5KWwieEmzvlFeh.vzt1abZEHH9cT.7p.MqLk2"/>
            <column name="full_name" value="Regular User"/>
            <column name="phone" value="+7 777 333 33 33"/>
            <column name="active" valueBoolean="true"/>
        </insert>
    </changeSet>

    <!-- USERS_ROLES -->
    <changeSet id="015-seed-users-roles" author="team">
        <insert tableName="users_roles">
            <column name="user_id" valueComputed="(SELECT id FROM users WHERE email='ruslanbek@booking.kz')"/>
            <column name="role_id" valueComputed="(SELECT id FROM roles WHERE name='ROLE_ADMIN')"/>
        </insert>

        <insert tableName="users_roles">
            <column name="user_id" valueComputed="(SELECT id FROM users WHERE email='kasym@booking.kz')"/>
            <column name="role_id" valueComputed="(SELECT id FROM roles WHERE name='ROLE_MANAGER')"/>
        </insert>

        <insert tableName="users_roles">
            <column name="user_id" valueComputed="(SELECT id FROM users WHERE email='maksat@booking.kz')"/>
            <column name="role_id" valueComputed="(SELECT id FROM roles WHERE name='ROLE_USER')"/>
        </insert>
    </changeSet>

    <!-- cities -->
    <changeSet id="016-seed-cities" author="team">
        <insert tableName="cities"><column name="name" value="Almaty"/><column name="country" value="Kazakhstan"/></insert>
        <insert tableName="cities"><column name="name" value="Astana"/><column name="country" value="Kazakhstan"/></insert>
        <insert tableName="cities"><column name="name" value="Shymkent"/><column name="country" value="Kazakhstan"/></insert>
    </changeSet>

    <!-- amenities -->
    <changeSet id="017-seed-amenities" author="team">
        <insert tableName="amenities"><column name="name" value="Wi-Fi"/></insert>
        <insert tableName="amenities"><column name="name" value="Breakfast"/></insert>
        <insert tableName="amenities"><column name="name" value="Pool"/></insert>
        <insert tableName="amenities"><column name="name" value="Parking"/></insert>
    </changeSet>

    <!-- hotel + rooms -->
    <changeSet id="018-seed-hotels-rooms" author="team">
        <insert tableName="hotels">
            <column name="name" value="Rixos Almaty"/>
            <column name="address" value="Seifullin Ave 506, Almaty"/>
            <column name="description" value="Premium hotel in the city center."/>
            <column name="rating" valueNumeric="4.7"/>
            <column name="active" valueBoolean="true"/>
            <column name="city_id" valueComputed="(SELECT id FROM cities WHERE name='Almaty')"/>
            <!-- FIXED: manager should exist in users table -->
            <column name="manager_id" valueComputed="(SELECT id FROM users WHERE email='kasym@booking.kz')"/>
        </insert>

        <insert tableName="rooms">
            <column name="room_number" value="101"/>
            <column name="type" value="STANDARD"/>
            <column name="price_per_night" valueNumeric="45000"/>
            <column name="capacity" valueNumeric="2"/>
            <column name="available" valueBoolean="true"/>
            <column name="hotel_id" valueComputed="(SELECT id FROM hotels WHERE name='Rixos Almaty')"/>
        </insert>

        <insert tableName="rooms">
            <column name="room_number" value="202"/>
            <column name="type" value="DELUXE"/>
            <column name="price_per_night" valueNumeric="70000"/>
            <column name="capacity" valueNumeric="3"/>
            <column name="available" valueBoolean="true"/>
            <column name="hotel_id" valueComputed="(SELECT id FROM hotels WHERE name='Rixos Almaty')"/>
        </insert>
    </changeSet>

    <!-- rooms_amenities -->
    <changeSet id="019-seed-rooms-amenities" author="team">

        <!-- Room 101: Wi-Fi, Breakfast, Parking -->
        <insert tableName="rooms_amenities">
            <column name="room_id"
                    valueComputed="(SELECT id FROM rooms WHERE room_number='101' AND hotel_id=(SELECT id FROM hotels WHERE name='Rixos Almaty'))"/>
            <column name="amenity_id"
                    valueComputed="(SELECT id FROM amenities WHERE name='Wi-Fi')"/>
        </insert>

        <insert tableName="rooms_amenities">
            <column name="room_id"
                    valueComputed="(SELECT id FROM rooms WHERE room_number='101' AND hotel_id=(SELECT id FROM hotels WHERE name='Rixos Almaty'))"/>
            <column name="amenity_id"
                    valueComputed="(SELECT id FROM amenities WHERE name='Breakfast')"/>
        </insert>

        <insert tableName="rooms_amenities">
            <column name="room_id"
                    valueComputed="(SELECT id FROM rooms WHERE room_number='101' AND hotel_id=(SELECT id FROM hotels WHERE name='Rixos Almaty'))"/>
            <column name="amenity_id"
                    valueComputed="(SELECT id FROM amenities WHERE name='Parking')"/>
        </insert>

        <!-- Room 202: Wi-Fi, Pool, Parking -->
        <insert tableName="rooms_amenities">
            <column name="room_id"
                    valueComputed="(SELECT id FROM rooms WHERE room_number='202' AND hotel_id=(SELECT id FROM hotels WHERE name='Rixos Almaty'))"/>
            <column name="amenity_id"
                    valueComputed="(SELECT id FROM amenities WHERE name='Wi-Fi')"/>
        </insert>

        <insert tableName="rooms_amenities">
            <column name="room_id"
                    valueComputed="(SELECT id FROM rooms WHERE room_number='202' AND hotel_id=(SELECT id FROM hotels WHERE name='Rixos Almaty'))"/>
            <column name="amenity_id"
                    valueComputed="(SELECT id FROM amenities WHERE name='Pool')"/>
        </insert>

        <insert tableName="rooms_amenities">
            <column name="room_id"
                    valueComputed="(SELECT id FROM rooms WHERE room_number='202' AND hotel_id=(SELECT id FROM hotels WHERE name='Rixos Almaty'))"/>
            <column name="amenity_id"
                    valueComputed="(SELECT id FROM amenities WHERE name='Parking')"/>
        </insert>

    </changeSet>

</databaseChangeLog>
